# ServerForGame
Для запуска необходимо:
* Установить nodeJS(>=v16.14) npm(>=v8.5.1);
* выполнить установку пакетов командой:  ```npm i```;
* отредактировать файл .env в соответствии с конфигурацией вашей БД;
* запустить сервер с помощью команды: ```npm start```.  

Для запуска режима разработчика необходимо ввести команду: ```npm run dev```.  
Для запуска через Docker необходимо запустить bash скрипт ```./setup-docker.sh```.

# Теория

- [Теория](#теория)
  - [Запросы](#запросы)
    - [Виды запросов](#виды-запросов)
  - [Маршруты](#маршруты)
  - [Параметры](#параметры)
- [Список всех запросов](#список-всех-запросов)
  - [/user](#user)
    - [Регистрация](#регистрация)
    - [Авторизация](#авторизация)
    - [Аутентификация](#аутентификация)
    - [Загрузка пользователей](#загрузка-пользователей)
    - [Удаление пользователей](#удаление-пользователей)
  - [/level](#level)
    - [Добавление уровня](#добавление-уровня)
    - [Загрузка уровней](#загрузка-уровней)
    - [Удаление уровней](#удаление-уровней)
    - [Получение случайного уровня](#получение-случайного-уровня)


## Запросы

Любой запрос представляет из себя адрес. В нашем случае, этот адрес обязательно начинается со следующей строки:

```
http://45.12.239.174:5000
```

Далее к нему добавляется путь запроса с рзделителем `/`

Вот пример запроса:

```
http://45.12.239.174:5000/api/level/download
```

### Виды запросов

Запросы бывают множества видов. В нашем случае используются только GET, POST и DELETE запросы.

*Каждый запрос может как **содержать** информацию от отправителя, так и **не содержать** вовсе.*

**POST** запросы несут в себе какую-либо информацию от отправителя для размещения в базе данных.

**DELETE** запросы несут в себе какую-либо информацию от отправителя для удаления из базы данных.

**GET** запросы несут в себе какую-либо информацию от отправителя для получения из базы данных.

## Маршруты

Структура маршрутов довольно простая. Маршрут начинается со `/api`. Далее указывается таблица, к которой необходимо обратиться. В нашем случае существует две таблицы: `/level` и `/user`.

Последним элементом маршрута указывается необходимое действие. У таблицы `/level` есть всего четыре действия: `/create`, `/update`, `/download` и `/delete`. У таблицы `/user` - пять действий: `/reg`, `/login`, `/auth`, `/download` и `/delete`.

## Параметры

Параметры можно указывать множеством способов. Прежде всего, рекомендую установить приложение postman. Оно поможет разобраться с видами запросов.

Пока что выделю два основных вида, принимаемых нашим сервером.

*   Первый - это простое указание параметров прямо в строке запроса после знака `?`. Такие виды запросов называются **query** запросами. Пример, такого запроса показан ниже:

```
http://45.12.239.174:5000/api/level/download?id=5
```

*   Второй - это указать параметры в **body** запросе. Такой запрос отправляется методами или функциями в программном коде с указанием параметров. Может быть представлен в json нотации, например:

```json
{
    "name": "Victor",
    "password": "12345"
}
```

Также существуют так называемые **Headers** параметры. Они отправляются вместе с любым запросом по умолчанию и содержат в себе информацию об адресе хоста, о статусе соединения, о длине запроса и т. д. Эти Headers параметры можно дополнять своими параметрами.

# Список всех запросов

Ниже представлены все существующие запросы к серверу по адресу <http://45.12.239.174:5000>.

## /user

### Регистрация

*   POST запрос. Выполняет регистрацию пользователя.

*   Принимает: поле "name", поле "password".

*   Возвращает токен регистрации, данные о пользователе в БД и идентификатор уровня пользователя.

```
http://45.12.239.174:5000/api/user/reg
```

### Авторизация

*   POST запрос. Выполняет авторизацию пользователя.

*   Принимает: body поле "name", body поле "password".

*   Возвращает токен авторизации и данные о пользователе в БД.

```
http://45.12.239.174:5000/api/user/login
```

### Аутентификация

*   POST запрос. Выполняет аутентификацию (проверку данных) пользователя. Иначе говоря, сверяет хранящийся у пользователя токен с токеном на сервере.

*   Принимает: токен в Headers параметре "authorization".

*   Возвращает токен авторизации в случае успешной проверки.

```
http://45.12.239.174:5000/api/user/auth
```

### Загрузка пользователей

*   GET запрос. Выполняет выборку пользователей из БД, соответствующих запросу.

*   Принимает: query поле "id" - идентификатор пользователя или задается без параметров.

*   Возвращает список пользователей с идентификаторами уровней соответствующих запросу. В случае, если параметры пусты, будут возвращены все пользователи с идентификаторами уровней из БД.

```
http://45.12.239.174:5000/api/user/download
```

### Удаление пользователей

*   DELETE запрос. Выполняет удаление пользователей из БД, соответствующих запросу.

*   Принимает: body поле "id" - идентификатор пользователя или задается без параметров.

*   Возвращает количество удаленных пользователей соответствующих запросу. В случае, если параметры пусты, будут удалены все пользователи из БД.

```
http://45.12.239.174:5000/api/user/delete
```

## /level

### Добавление уровня

*   POST запрос. Выполняет добавление уровня в виде строки по id пользователя.

*   Принимает: body поле "userId" - идентификатор пользователя, body поле "level\_address" - содержимое уровня в виде строки.

*   Возвращает данные об измененном объекте уровня из БД.

```
http://45.12.239.174:5000/api/level/create
```

### Загрузка уровней

*   GET запрос. Выполняет выборку уровней из БД, соответствующих запросу.

*   Принимает: query поле "id" - идентификатор уровня или задается без параметров.

*   Возвращает содержимое уровней соответствующих запросу. В случае, если параметры пусты, будут возвращены данныео обо всех уровнях из БД.

```
http://45.12.239.174:5000/api/level/download
```

### Удаление уровней

*   DELETE запрос. Выполняет удаление уровней из БД, соответствующих запросу.

*   Принимает: body поле "id" - идентификатор уровня или задается без параметров.

*   Возвращает количество удаленных уровней соответствующих запросу. В случае, если параметры пусты, будут удалены все уровни из БД.

```
http://45.12.239.174:5000/api/level/delete
```

### Получение случайного уровня

*   GET запрос. Выполняет выборку случайного уровня из БД не равного уровню конкретного пользователя

*   Принимает: query поле "userId" - идентификатор пользователя.

*   Возвращает данные о пользователе-владельце случайно найденного уровня, а также идентефикатор найденного уровня вместе с содержимым найденного уровня. Содержимое уровня располагается в подполе level_content поля level. 

```
http://45.12.239.174:5000/api/level/random
```
